/*
 * Licensed to SK Telecom Co., LTD. (SK Telecom) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  SK Telecom licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

package io.druid.segment.data;

import com.google.common.collect.Maps;
import com.google.common.collect.Range;
import com.metamx.collections.bitmap.BitmapFactory;
import com.metamx.collections.bitmap.ConciseBitmapFactory;
import com.metamx.collections.bitmap.ImmutableBitmap;
import io.druid.common.utils.Ranges;
import io.druid.data.ValueDesc;
import io.druid.data.ValueType;
import io.druid.segment.bitmap.BitSetBitmapFactory;
import io.druid.segment.bitmap.RoaringBitmapFactory;
import io.druid.segment.column.Column;
import io.druid.segment.column.ColumnBuilder;
import io.druid.segment.serde.ColumnPartSerde;
import org.junit.Assert;
import org.junit.Ignore;
import org.junit.Test;
import org.roaringbitmap.IntIterator;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.nio.ByteBuffer;
import java.nio.channels.WritableByteChannel;
import java.util.Arrays;
import java.util.Collections;
import java.util.Map;
import java.util.Random;

@Ignore("Not using")
public class BitSlicedBitmapTest
{
  private final BitmapFactory factory = new RoaringBitmapFactory();

  private <T extends Comparable> String find(BitSlicedBitmap<T> bitmap, Range<T> range)
  {
    return BitSlicedBitmaps.toString(bitmap.filterFor(range, null).bitmap());
  }

  @Test
  public void testLong()
  {
    BitSlicer<Long> slicer = new BitSlicer.LongType(factory);
    for (long v : new long[]{Long.MAX_VALUE, 20000L, 15000L, 18000L, 15000L, 25000L, 30000L, Long.MIN_VALUE + 10}) {
      slicer.add(v);
    }
    BitSlicedBitmap<Long> bitmap = slicer.build();

    long v = 20000;
    System.out.println(">> " + bitmap.filterFor(Range.greaterThan(v), null));
    System.out.println(">> " + bitmap.filterFor(Range.atLeast(v), null));
    System.out.println(">> " + bitmap.filterFor(Range.lessThan(v), null));
    System.out.println(">> " + bitmap.filterFor(Range.atMost(v), null));
    System.out.println(">> " + bitmap.filterFor(Range.closed(v, v), null));
  }

  @Test
  public void testFloat()
  {
    BitSlicer<Float> slicer = new BitSlicer.FloatType(factory);
    float[] values = {Float.MAX_VALUE, -1000.1f, -2000.2f, 4000.3f, 0.4f, 12000.5f, -7000.6f, 1800.7f, Float.MIN_VALUE};
    for (float v : values) {
      slicer.add(v);
    }
    BitSlicedBitmap<Float> bitmap = slicer.build();

    Assert.assertEquals("0,3,5,7", find(bitmap, Range.greaterThan(0.4f)));
    Assert.assertEquals("0,3,4,5,7", find(bitmap, Range.atLeast(0.4f)));
    Assert.assertEquals("1,2,6,8", find(bitmap, Range.lessThan(0.4f)));
    Assert.assertEquals("1,2,4,6,8", find(bitmap, Range.atMost(0.4f)));
    Assert.assertEquals("4", find(bitmap, Range.closed(0.4f, 0.4f)));

    Assert.assertEquals("0,1,3,4,5,7,8", find(bitmap, Range.atLeast(-1000.1f)));
    Assert.assertEquals("1,2,4,6,7,8", find(bitmap, Range.lessThan(4000.3f)));
    Assert.assertEquals("1,4,7,8", find(bitmap, Range.closedOpen(-1000.1f, 4000.3f)));
  }

  @Test
  public void ensureLongSorted()
  {
    BitSlicer<Long> slicer = new BitSlicer.LongType(factory);
    Random r = new Random();
    for (int x = 0; x < 32; x++) {
      Map<Long, String> values = Maps.newTreeMap();
      for (int i = 0; i < 65536; i++) {
        long v = r.nextLong();
        values.put(v, slicer.toBitmapString(v));
      }
      values.put(Long.MAX_VALUE, slicer.toBitmapString(Long.MAX_VALUE));
      values.put(Long.MIN_VALUE, slicer.toBitmapString(Long.MIN_VALUE));
      values.put(0L, slicer.toBitmapString(0L));

      String[] duplicate = values.values().toArray(new String[values.size()]);
      Arrays.parallelSort(duplicate);
      int i = 0;
      for (Map.Entry<Long, String> e : values.entrySet()) {
        Assert.assertEquals(i + " th.. " + e + " vs " + duplicate[i], e.getValue(), duplicate[i]);
        i++;
      }
    }
  }

  @Test
  public void ensureFloatSorted()
  {
    BitSlicer<Float> slicer = new BitSlicer.FloatType(factory);
    String ZERO = slicer.toBitmapString(0f);
    String POSITIVE_MIN = slicer.toBitmapString(Float.intBitsToFloat(0b0_00000000_0000000_00000000_00000001)); // MIN_VALUE
    String POSITIVE_1 = slicer.toBitmapString(Float.intBitsToFloat(0b0_00000000_1111111_11111111_11111111));
    String POSITIVE_2 = slicer.toBitmapString(Float.intBitsToFloat(0b0_00000001_0000000_00000000_00000001));  // MIN_NORMAL
    String NEGATIVE_MIN = slicer.toBitmapString(Float.intBitsToFloat(0b1_00000000_0000000_00000000_00000001));
    String NEGATIVE_1 = slicer.toBitmapString(Float.intBitsToFloat(0b1_00000000_1111111_11111111_11111111));
    String NEGATIVE_2 = slicer.toBitmapString(Float.intBitsToFloat(0b1_00000001_0000000_00000000_00000001));

    String MAX_VALUE = slicer.toBitmapString(Float.MAX_VALUE);
    String POSITIVE_INFINITY = slicer.toBitmapString(Float.POSITIVE_INFINITY);
    String MIN_VALUE = slicer.toBitmapString(-Float.MAX_VALUE);
    String NEGATIVE_INFINITY = slicer.toBitmapString(Float.NEGATIVE_INFINITY);

    String NAN = slicer.toBitmapString(Float.NaN);
    Assert.assertEquals(NAN, slicer.toBitmapString(-Float.NaN));

    String[] expected = new String[]{
        NAN,
        NEGATIVE_INFINITY,
        MIN_VALUE,
        NEGATIVE_2,
        NEGATIVE_1,
        NEGATIVE_MIN,
        ZERO,
        POSITIVE_MIN,
        POSITIVE_1,
        POSITIVE_2,
        MAX_VALUE,
        POSITIVE_INFINITY,
    };
    String[] array = Arrays.copyOf(expected, expected.length);
    for (int x = 0; x < 10; x++) {
      Collections.shuffle(Arrays.asList(array));
      Arrays.sort(array);
    }
    Assert.assertArrayEquals(expected, array);
    for (int i = 1; i < array.length; i++) {
      Assert.assertTrue(array[i - 1].compareTo(array[i]) != 0);
    }
  }

  @Test
  @Ignore("takes too much time")
  public void ensureSorted()
  {
    BitSlicer<Float> slicer = new BitSlicer.FloatType(factory);
    String prev = null;
    for (int i = 0; i <= Float.floatToIntBits(Float.POSITIVE_INFINITY); i++) {
      String c = slicer.toBitmapString(Float.intBitsToFloat(i));
      if (prev != null && c.compareTo(prev) <= 0) {
        throw new RuntimeException("[BitSlicedBitmapTest/ensureSorted] " + i + " --> " + c + " (" + prev + ")");
      }
      prev = c;
      if (i % 1_0000_0000 == 0) {
        System.out.print("x");
      } else if (i % 100_0000 == 0) {
        System.out.print(".");
      }
    }
    prev = null;
    for (int i = 0; i <= Float.floatToIntBits(Float.POSITIVE_INFINITY); i++) {
      String c = slicer.toBitmapString(-Float.intBitsToFloat(i));
      if (prev != null && c.compareTo(prev) >= 0) {
        throw new RuntimeException("[BitSlicedBitmapTest/ensureSorted] " + i + " --> " + c + " (" + prev + ")");
      }
      prev = c;
      if (i % 1_0000_0000 == 0) {
        System.out.print("x");
      } else if (i % 100_0000 == 0) {
        System.out.print(".");
      }
    }
  }

  @Test
  public void ensureDoubleSorted()
  {
    BitSlicer<Double> slicer = new BitSlicer.DoubleType(factory);
    Random r = new Random();
    final int expDelta = Double.MAX_EXPONENT - Double.MIN_EXPONENT;
    for (int x = 0; x < 32; x++) {
      Map<Double, String> values = Maps.newTreeMap();
      for (int i = 0; i < 65536; i++) {
        double v = (r.nextDouble() - 0.5f) * Math.pow(10, r.nextInt(expDelta) - Double.MAX_EXPONENT);
        values.put(v, slicer.toBitmapString(v));
      }
      values.put(Double.MAX_VALUE, slicer.toBitmapString(Double.MAX_VALUE));
      values.put(Double.MIN_VALUE, slicer.toBitmapString(Double.MIN_VALUE));
      values.put(Double.MIN_NORMAL, slicer.toBitmapString(Double.MIN_NORMAL));
      values.put(Double.longBitsToDouble(0x01), slicer.toBitmapString(Double.longBitsToDouble(0x01)));
      values.put(
          Double.longBitsToDouble(0x8000000000000001L), slicer.toBitmapString(
              Double.longBitsToDouble(
                  0x8000000000000001L
              )
          )
      );
      values.put(0D, slicer.toBitmapString(0D));
      values.put(-0D, slicer.toBitmapString(-0D));

      String[] duplicate = values.values().toArray(new String[values.size()]);
      Arrays.parallelSort(duplicate);
      int i = 0;
      for (Map.Entry<Double, String> e : values.entrySet()) {
        Assert.assertEquals(i + " th.. " + e + " vs " + duplicate[i], e.getValue(), duplicate[i]);
        i++;
      }
    }
  }

  @Test
  public void testLongRanges()
  {
    final long[] input = new long[]{
        105000, 132500, 38000, 59900, 69000, 42000, 49500, 48700, 50000, 50000, 49000, 49400, 60000, 60000, 22300, 52000, 62100, 66500, 62500, 63000, 62500, 65000, 63500, 65000, 67000, 67000, 67000, 68000, 75500, 75000, 75100, 75400, 76500, 77000, 75200, 92500, 90000, 90000, 88000, 88000, 89800, 100000, 52700, 78000, 72000, 72000, 73500, 67000, 72000, 73500, 73500, 72300, 83000, 67000, 66500, 75000, 75500, 74900, 75500, 46250, 75500, 76700, 77000, 78000, 76000, 92000, 91500, 90000, 71000, 78000, 70000, 47500, 145000, 70000, 23300, 68500, 71000, 90000, 85000, 83000, 76000, 62500, 77000, 93990, 34100, 33500, 40000, 75000, 106700, 116000, 113000, 150000, 141000, 179800, 25700, 24850, 70000, 71800, 102000, 105000, 93000, 114000, 118000, 128000, 128000, 126500, 180000, 197000, 64000, 79500, 172700, 41800, 65200, 96700, 98500, 115000, 134000, 155000, 69000, 157500, 32000, 60000, 79000, 98200, 117000, 110000, 123000, 26000, 95000, 102000, 129000, 76000, 123500, 110000, 159500, 140000, 151500, 174000, 84000, 94000, 81000, 82000, 76500, 110000, 67000, 67000, 102500, 105000, 167000, 178000, 72200, 79500, 77500, 238000, 247000, 138000, 220000, 77000, 64000, 62000, 70900, 62000, 26500, 140000, 27500, 135000, 160000, 128000, 173000, 190000, 177000, 70000, 70000, 195000, 86000, 58500, 79000, 69000, 97000, 81500, 64500, 64000, 55000, 55000, 75000, 75000, 64900, 115000, 70000, 116000, 71500, 54800, 73000, 67000, 82500, 36500, 34500, 53100, 50000, 66000, 66000, 77000, 53000, 53000, 80000, 81000, 75000, 45500, 50500, 52500, 48000, 64000, 58000, 207000, 145500, 102000, 108500, 155000, 212500, 210000, 218000, 142500, 85000, 85000, 87000, 120500, 125000, 135000, 128500, 129000, 129000, 75000, 83000, 88000, 110000, 107000, 124500, 73500, 89300, 89300, 96500, 25000, 24000, 28500, 27000, 63000, 69000, 103000, 147000, 101000, 105000, 103000, 114000, 54500, 71000, 77500, 42000, 136000, 134500, 49500, 59900, 79500, 70000, 83000, 67000, 18000, 53000, 12000, 24400, 24800, 28000, 72750, 86000, 90000, 33500, 32000, 88000, 90000, 89990, 89990, 86000, 86000, 90000, 60000, 60000, 82000, 77000, 83000, 93000, 94900, 122000, 57000, 80000, 105000, 86300, 99500, 103000, 132000, 93000, 89850, 176000, 230000, 220000, 145000, 67000, 44500, 44700, 47950, 50000, 45500, 45300, 45000, 46000, 45900, 44000, 40250, 44000, 45700, 47600, 46500, 41200, 41200, 45500, 48300, 47000, 46800, 49700, 50000, 43700, 44000, 53200, 52500, 59900, 59800, 56700, 68800, 69400, 69500, 80400, 91800, 39600, 43000, 44000, 46000, 51000, 51000, 51000, 56000, 58000, 65000, 63000, 64800, 57500, 67700, 47500, 32000, 34000, 34000, 12800, 12800, 14300, 59400, 27400, 36200, 33000, 33500, 28400, 40000, 40000, 42000, 36800, 39500, 44000, 38700, 64000, 68450, 67500, 78200, 77450, 87900, 82800, 84000, 83000, 64500, 76000, 78000, 86000, 86000, 86200, 62900, 81700, 88500, 86400, 87500, 87300, 34800, 35000, 45500, 43500, 38250, 37000, 37000, 37300, 36700, 52000, 36750, 36700, 60000, 34700, 47000, 43000, 43000, 41000, 49800, 29300, 49250, 52800, 45800, 28000, 34000, 50900, 49000, 50900, 52000, 35700, 46000, 48000, 53000, 55200, 35700, 33100, 37000, 39200, 40900, 41000, 40500, 42900, 42000, 30200, 30500, 29700, 28500, 36000, 44900, 39000, 39000, 31900, 39350, 46800, 54200, 56000, 67000, 55200, 68000, 55500, 58200, 52000, 69000, 61500, 41700, 37000, 29000, 40000, 42000, 42500, 44000, 45500, 46000, 46000, 46000, 46000, 48000, 46000, 46500, 51300, 51000, 52500, 51950, 53500, 44800, 43500, 45000, 44450, 55000, 56000, 60000, 43000, 46000, 47000, 47000, 63000, 68000, 45000, 41890, 47800, 41000, 39500, 44700, 31000, 37950, 32500, 39500, 40000, 52300, 24500, 32900, 49500, 30850, 39500, 31300, 36000, 51000, 48000, 41200, 53500, 89900, 42400, 56250, 39300, 41700, 40000, 46000, 55000, 55800, 50300, 59000, 68500, 45000, 44100, 36900, 51500, 58800, 59000, 81500, 35500, 33400, 17700, 51700, 35500, 36500, 46900, 45800, 50000, 49500, 36500, 48000, 18200, 51500, 51500, 37400, 37000, 32100, 31800, 40900, 46000, 43000, 34000, 39000, 34980, 44500, 49000, 37200, 22400, 42900, 26650, 25800, 30000, 28500, 35300, 33300, 34500, 39000, 37200, 38500, 39900, 38800, 39500, 44200, 38250, 37250, 47000, 45600, 47000, 47400, 30000, 31000, 32000, 30800, 28000, 30500, 30800, 30800, 31500, 31500, 38500, 37700, 36500, 36000, 35500, 36500, 35500, 36500, 37500, 36800, 37500, 36500, 37800, 37000, 36000, 37800, 34500, 37000, 36400, 36000, 35400, 37000, 36800, 38000, 36000, 36500, 40700, 42400, 43700, 39300, 13000, 15000, 29700, 29300, 25300, 24900, 24400, 30000, 26000, 32400, 33900, 24500, 30800, 27000, 19000, 18500, 18500, 17700, 18000, 23900, 23700, 23800, 23000, 23900, 33000, 33500, 33000, 32870, 18000, 23000, 31250, 38000, 29200, 31000, 22000, 25000, 15100, 29500, 23100, 23100, 31500, 32800, 29900, 49500, 36100, 26000, 27000, 43500, 19000, 10500, 10500, 10400, 10400, 10500, 10400, 10400, 10500, 10400, 10400, 10400, 10400, 10400, 21700, 31200, 39000, 39500, 25500, 18000, 18200, 16700, 18000, 16150, 19000, 21300, 22000, 22900, 29000, 28500, 26000, 28500, 23000, 23350, 23700, 23850, 30000, 27900, 29750, 26500, 31900, 29300, 29400, 26500, 30000, 33000, 32500, 38400, 37300, 37000, 38000, 37900, 18300, 21000, 21000, 20300, 24800, 24000, 24700, 24800, 30900, 33000, 31750, 35500, 38300, 44000, 40000, 18900, 19000, 24000, 22900, 22500, 19000, 23000, 23500, 29500, 28200, 53200, 52000, 52000, 52450, 60000, 63000, 53000, 45700, 44900, 45200, 45000, 45000, 44500, 26500, 32500, 31700, 36300, 37100, 38500, 49000, 34800, 40500, 26500, 49500, 47000, 52500, 51700, 48000, 52800, 49500, 50650, 51500, 51000, 50000, 53000, 52000, 52000, 48700, 51000, 48000, 51000, 50000, 40000, 39000, 39500, 43150, 41800, 41800, 40000, 42000, 43000, 41000, 41000, 40000, 52000, 51000, 42000, 43000, 41700, 40300, 41900, 42000, 41500, 42000, 39500, 39000, 39500, 50000, 45000, 25400, 31800, 33000, 46000, 50000, 53700, 48000, 49500, 51000, 64500, 67000, 65000, 70250, 75500, 71000, 42900, 34300, 46300, 28000, 31500, 33900, 18000, 33000, 42500, 47000, 49800, 52000, 56000, 50000, 55500, 57700, 54000, 39900, 33500, 46800, 47500, 55500, 55000, 57000, 23500, 22100, 22000, 22500, 23000, 23300, 23000, 23900, 31000, 52500, 54500, 53500, 52000, 71000, 70500, 30000, 30000, 33000, 33300, 33300, 43200, 42300, 43500, 45200, 32500, 29500, 30000, 25000, 24700, 32500, 36900, 36900, 35000, 32900, 37100, 36900, 35500, 20000, 25400, 24000, 22700, 25550, 32800, 36450, 35000, 36000, 36000, 34000, 31000, 33800, 34000, 33500, 23500, 24400, 24000, 24400, 45000, 30000, 35000, 40800, 36950, 35000, 45000, 57000, 68000, 83430, 69700, 69700, 70000, 63500, 84500, 33900, 36900, 34000, 32700, 53000, 45000, 45000, 51000, 54500, 9600, 40000, 43800, 40000, 50750, 32000, 37800, 39800, 10500, 9700, 10500, 9900, 9700, 9900, 10600, 13000, 13000, 13300, 14000, 14000, 17000, 40000, 31000, 36000, 39500, 42000, 38000, 42800, 47300, 34000, 35000, 58000, 34900, 39800, 20300, 17500, 20500, 21000, 18800, 24900, 30000, 30500, 38900, 42100, 35000, 33700, 37700, 33900, 17000, 16600, 17900, 17000, 17800, 29000, 16500, 20000, 19000, 19200, 20500, 21000, 19000, 20000, 20000, 20900, 24000, 24900, 34500, 33000, 32000, 36700, 47500, 50200, 31500, 30000, 44800, 35900, 38000, 29800, 29900, 37400, 36500, 46000, 26000, 26500, 29800, 30000, 34000, 34000, 31700, 33200, 26450, 20000, 27000, 29700, 35000, 24750, 35000, 24100, 27800, 30500, 30800, 34000, 40500, 32800, 38000, 47000, 49800, 46900, 49500, 49900, 48500, 50200, 51500, 30000, 36800, 32900, 43500, 31600, 44800, 43800, 43500, 40000, 15300, 15700, 15500, 15800, 15200, 15500, 15500, 58500, 51000, 69700, 31800, 29000, 39800, 29800, 27300, 41800, 48000, 40000, 49700, 48750, 60000, 60000, 46500, 48500, 40800, 36500, 40500, 49600, 35000, 49500, 31500, 40000, 32800, 32800, 33000, 37500, 40500, 39300, 38300, 37000, 35500, 39750, 32800, 25700, 50000, 31500, 48500, 63200, 62800, 64600, 74066, 75611, 76154, 76154, 78794, 75611, 74066, 74066, 76375, 77312, 79539, 77312, 77312, 75611, 76154, 74836, 79007, 88240, 87168, 86919, 84428, 85941, 86919, 85941, 84174, 88416, 18900, 17500, 19000, 31500, 28000, 15500, 17800, 28000, 18300, 23700, 50800, 54500, 51500, 52200, 52500, 65500, 70000, 69000, 48800, 49200, 62500, 61750, 56000, 55000, 65000, 68000, 65000, 73800, 70000, 72700, 51700, 26500, 24800, 30500, 28000, 23000, 24100, 19800, 21000, 26300, 24500, 19600, 25900, 31300, 32600, 28000, 30000, 24800, 23800, 19000, 17500, 37800, 28700, 51800, 47000, 56500, 51000, 64500, 67000, 17900, 44000, 45000, 63000, 53000, 47000, 15500, 14800, 41000, 40000, 41800, 49300, 35500, 45500, 47000, 51500, 53000, 35900, 45700, 49850, 52500, 38000, 37800, 37300, 17800, 18000, 43000, 39300, 37000, 38500, 38500, 48000, 58500, 29000, 41000, 42400, 41800, 42500, 42700, 50500, 50900, 54000, 57900, 56300, 31500, 38400, 31700, 32500, 41900, 42000, 46500, 44000, 41300, 48800, 43800, 40000, 45000, 44000, 12900, 14000, 31750, 40200, 43000, 44000, 38400, 34000, 36000, 49000, 53500, 47000, 57500, 51000, 50000, 35800, 34800, 42500, 42000, 41250, 45800, 40000, 35500, 17200, 13800, 40500, 14900, 29000, 43000, 48500, 47000, 47000, 45000, 32800, 31300, 31450, 32800, 38100, 38000, 26300, 13500, 13500, 12500, 18000, 13500, 18300, 19300, 32600, 23200, 22700, 38300, 24000, 33000, 39000, 34500, 35500, 33000, 32500, 32500, 34300, 41300, 41800, 41000, 39500, 39500, 41800, 41000, 42000, 40000, 39100, 46500, 46500, 24000, 22500, 30400, 31300, 31900, 28000, 30650, 30000, 25000, 35000, 31000, 30800, 26000, 34000, 28800, 23000, 29000, 29700, 30900, 30400, 31700, 32500, 34000, 31400, 27000, 38500, 28000, 42000, 39000, 48750, 50500, 49000, 48500, 58000, 54500, 53800, 55500, 60800, 68000, 28850, 29300, 47000, 34100, 34700, 25000, 27800, 33300, 13300, 28500, 25000, 29900, 28700, 30000, 53500, 53500, 52500, 52700, 93000, 129500, 51500, 50000, 59300, 60000, 60000, 49800, 61500, 60000, 56000, 60000, 70500, 72000, 64500, 54900, 55500, 72300, 53700, 54500, 53000, 60000, 36800, 55000, 67000, 55000, 59400, 56000, 56800, 83000, 47500, 34500, 34200, 69000, 32800, 72000, 30000, 38000, 65000, 93000, 86700, 101000, 101000, 97000, 102000, 101620, 124000, 134000, 126000, 36500, 42500, 57900, 56300, 61800, 49500, 38900, 44750, 50000, 41500, 53000, 60000, 62000, 68000, 68400, 59980, 73000, 78500, 73000, 123000, 68000, 69300, 48370, 55300, 43700, 42800, 47800, 35600, 41000, 59000, 36500, 57000, 57000, 43000, 36500, 86500, 46500, 26900, 31500, 37500, 19000, 22800, 24700, 13300, 13250, 13447, 38500, 49000, 47600, 48000, 45700, 46700, 15500, 16150, 23400, 29700, 20000, 19200, 28500, 21000, 23000, 17000, 26900, 33000, 24700, 33000, 32000, 34000, 35500, 34500, 29900, 24900, 31700, 31900, 34100, 34900, 35000, 35800, 31500, 27000, 32000, 28800, 29500, 29500, 28500, 25800, 25000, 31500, 34700, 32500, 33500, 33000, 32950, 33400, 34300, 33800, 35850, 34000, 35300, 35700, 36400, 35500, 35000, 36150, 35600, 44000, 42500, 41000, 45700, 46300, 41600, 45800, 18500, 24500, 24200, 32500, 32000, 40950, 39500, 42000, 41900, 40300, 38500, 48800, 63600, 64000, 18500, 24900, 27500, 33400, 39500, 43000, 41000, 24800, 25600, 26000, 34800, 31000, 32200, 29500, 28000, 31600, 29050, 30200, 34300, 35700, 42300, 23900, 32400, 14800, 10200, 11300, 26800, 28300, 27000, 24400, 24000, 23750, 24450, 24400, 24280, 24000, 23400, 27800, 24600, 24300, 37500, 32300, 32500, 31500, 36500, 24800, 27900, 27900, 25100, 27000, 26200, 12600, 22000, 35000, 23000, 34500, 36900, 35900, 40900, 41700, 42000, 40500, 41800, 27750, 43000, 53250, 54000, 30700, 31000, 11000, 31500, 34500, 42500, 26500, 35000, 16500, 16800, 47500, 43000, 50000, 43000, 46900, 38000, 36000, 35000, 29950, 30000, 45200, 30800, 36700, 37000, 40000, 17500, 23500, 22000, 33800, 31500, 30500, 31000, 30400, 33000, 33500, 40300, 39100, 7050, 16500, 14500, 31500, 30400, 17000, 21800, 27200, 39300, 32400, 30000, 35500, 35500, 34900, 36000, 33400, 37000, 35750, 28000, 47900, 45500, 45500, 36200, 36800, 38500, 38500, 36750, 40000, 46250, 56300, 50400, 37600, 37900, 49700, 59000, 47600, 46000, 46500, 54500, 75000, 85000, 85000, 86200, 54750, 47800, 57800, 42700, 42700, 39900, 50300, 49500, 51750, 50500, 52800, 54300, 53000, 53000, 45000, 39500, 45200, 45700, 52000, 56500, 55000, 68000, 84200, 18800, 27500, 27900, 67500, 66000, 78000, 30500, 30000, 36000, 32800, 37000, 40500, 37000, 33000, 17000, 26000, 33800, 40000, 14850, 29300, 31500, 31300, 31300, 33500, 34700, 25800, 31500, 33500, 32500, 31350, 31700, 29000, 28500, 27000, 28000, 26000, 28500, 25500, 34800, 35000, 35000, 38000, 44700, 43350, 47900, 52400, 42500, 40500, 41500, 21500, 22800, 30000, 30500, 38500, 39500, 42700, 24400, 24800, 30000, 27900, 27800, 27900, 34450, 35700, 26400, 33800, 34000, 34800, 37000, 16600, 18300, 17050, 21900, 25400, 25000, 30000, 18000, 24750, 29700, 23800, 21500, 29200, 28500, 35700, 37500, 38500, 24000, 24500, 24000, 28400, 32000, 30000, 35000, 34300, 36500, 33400, 34600, 35000, 35100, 39000, 40800, 42500, 28000, 21400, 21400, 25500, 22500, 24100, 26600, 26200, 27000, 33000, 33000, 34900, 33700, 32000, 33800, 39300, 38000, 36700, 24600, 35500, 28000, 17650, 17500, 24100, 25250, 27300, 39900, 40500, 45900, 49400, 46900, 45000, 45400, 47800, 56500, 57000, 52670, 69000, 17800, 19950, 18000, 19000, 25000, 30000, 28000, 33875, 21000, 23750, 31500, 30900, 32500, 34600, 34000, 35200, 27500, 28900, 18900, 26250, 26300, 39000, 37700, 37700, 39500, 25700, 28000, 29000, 8000, 26800, 38900, 39000, 26800, 27000, 26950, 27400, 35000, 36000, 35000, 36200, 29900, 25000, 25500, 24800, 29500, 26400, 31600, 26000, 31300, 38000, 34000, 24000, 31600, 27500, 27000, 27500, 48000, 25700, 25100, 26600, 22800, 22000, 22700, 21200, 22600, 35000, 16100, 15500, 15800, 13500, 17000, 23100, 23000, 15000, 15500, 18000, 15700, 16900, 17900, 17900, 34700, 37350, 41000, 40200, 24850, 23800, 24950, 24500, 33800, 39000, 42400, 40800, 41800, 12300, 33000, 30500, 37600, 37100, 39800, 27200, 29800, 31000, 40500, 43000, 43500, 39300, 36000, 33000, 40000, 37000, 35000, 25000, 23000, 22700, 25500, 48000, 16900, 17200, 17300, 19000, 30400, 18900, 23700, 22500, 22000, 29700, 30000, 29300, 34000, 28200, 26900, 25700, 27300, 26800, 28000, 30000, 29700, 32000, 42000, 52700, 39000, 23000, 24000, 23200, 23500, 33500, 26000, 38500, 16400, 18420, 19000, 16750, 21800, 26000, 26000, 28000, 25800, 31000, 30900, 21000, 20900, 26500, 29200, 27500, 25800, 30000, 33050, 32500, 25000, 20800, 24800, 25900, 23900, 30000, 29000, 18000, 18400, 18000, 17400, 20000, 19700, 20000, 18000, 19000, 18200, 24950, 22950, 29600, 15850, 17400, 19400, 21900, 22000, 18350, 18000, 17300, 17000, 17000, 22770, 26500, 42400, 16000, 18500, 18300, 27800, 25000, 24900, 26000, 25500, 25000, 26000, 18000, 20850, 17200, 19850, 27800, 25200, 26500, 26000, 25500, 23100, 30600, 28000, 19000, 17000, 26500, 26000, 27000, 31700, 38700, 36500, 19000, 20500, 25800, 20800, 20900, 21400, 22000, 21100, 15900, 18800, 19000, 22000, 25600, 25800, 24250, 25500, 25300, 31500, 26600, 30000, 28500, 24700, 27000, 27500, 25000, 24500, 22000, 24000, 19000, 22300, 22900, 24500, 24500, 23000, 27700, 30700, 26000, 30500, 28350, 21800, 24000, 24000, 27800, 27800, 28000, 19000, 19000, 18500, 20000, 19500, 23875, 25000, 23000, 24000, 27500, 27550, 27700, 28500, 32500, 38500, 28700, 28750, 29000, 31000, 32200, 34000, 23900, 28000, 12190, 12000, 22500, 39100, 32000, 40800, 37300, 38000, 17380, 17380, 22800, 22800, 25900, 25800, 27700, 26000, 28000, 24500, 16500, 16500, 23900, 26000, 29500, 26400, 56650, 55000, 28500, 27000, 36750, 41000, 36800, 23000, 20000, 22800, 21500, 21800, 26800, 23900, 29250, 29500, 32350, 30000, 29300, 34500, 33000, 25650, 25350, 46500, 25900, 25750, 25700, 32100, 30500, 36100, 33800, 42400, 46000, 55000, 55000, 55000, 20400, 14500, 14900, 16800, 22500, 19500, 31000, 32000, 29100, 31450, 29600, 31650, 23500, 23400, 23500, 23750, 23400, 25000, 24000, 22000, 28000, 28000, 26400, 28000, 20000, 20900, 29500, 31400, 36000, 21900, 20900, 28000, 27500, 14500, 15000, 15000, 16200, 16800, 16000, 20700, 14000, 16000, 19200, 20500, 13500, 15200, 14500, 18300, 17000, 22500, 15900, 21500, 21800, 34500, 40000, 43500, 41300, 36000, 33500, 35500, 43000, 37250, 40000, 41500, 42700, 47000, 39000, 46500, 43500, 51500, 26900, 27800, 28900, 28000, 29950, 38400, 30700, 30000, 37500, 35000, 52000, 53200, 55000, 54500, 57400, 54800, 26000, 37500, 49000, 31700, 27300, 29800, 36000, 36800, 38000, 70800, 70000, 69000, 85700, 64000, 25500, 43500, 13600, 12500, 13250, 57000, 57700, 57300, 67200, 26000, 26800, 56800, 37000, 34500, 35400, 34350, 43900, 48500, 58000, 62000,
        74500, 50500, 49000, 48400, 29200, 46000, 49000, 26900, 28000, 26400, 34200, 34400, 31700, 36000, 34400, 18000, 17300, 17800, 17100, 15500, 17000, 17000, 18000, 20000, 17500, 24800, 33000, 33300, 37500, 38500, 17000, 17000, 17000, 17200, 16800, 19900, 17950, 18800, 19500, 20000, 17800, 18200, 20900, 20000, 32900, 30500, 32800, 31600, 43500, 43000, 17800, 18950, 19300, 19100, 18450, 19100, 18000, 16950, 18000, 17950, 18000, 17900, 16900, 18000, 17000, 23250, 23000, 22500, 23500, 24000, 24900, 24300, 28000, 14000, 28300, 27200, 18600, 19700, 19250, 19300, 18200, 18100, 23300, 24800, 24800, 21000, 24500, 22200, 24850, 25000, 25200, 22900, 27000, 25850, 25600, 29700, 28500, 28900, 18900, 18300, 18500, 18500, 18000, 17500, 18000, 24200, 24500, 22750, 24500, 24700, 25100, 28200, 28000, 28300, 36500, 36000, 33000, 33500, 60000, 57000, 61000, 60000, 62500, 55200, 54500, 57500, 58200, 45000, 41000, 55000, 54000, 31500, 33000, 31000, 34000, 31000, 21850, 37000, 26900, 26900, 33800, 37000, 35300, 40800, 56750, 41850, 42500, 53500, 48000, 53300, 49400, 18500, 19000, 18500, 22300, 21700, 23500, 22000, 24000, 15000, 16300, 22500, 19700, 47000, 47900, 48500, 31000, 31800, 30800, 32000, 42000, 46600, 46500, 49700, 49400, 15500, 14400, 14270, 14400, 14300, 19500, 19700, 18300, 19000, 37300, 42700, 44000, 35500, 28750, 26500, 29000, 16650, 20000, 19100, 20800, 21500, 23400, 24800, 33000, 25800, 33550, 30750, 30500, 31500, 30000, 31200, 31700, 32000, 31000, 30500, 33600, 31000, 31800, 32700, 24500, 24100, 28500, 35000, 29500, 28300, 45800, 14750, 17350, 36700, 39500, 37500, 45000, 36900, 42500, 37500, 36500, 20500, 22500, 30100, 31000, 29000, 20400, 23000, 17000, 16700, 15250, 16800, 17000, 19000, 20500, 20200, 19300, 21000, 21500, 24450, 22300, 29400, 36500, 40000, 27500, 32200, 42500, 43800, 20000, 22300, 20500, 12450, 17750, 22500, 19000, 30000, 29000, 30500, 30500, 30500, 29850, 23500, 14800, 15000, 16500, 15900, 16000, 29450, 27700, 27000, 27800, 25000, 27300, 30000, 40000, 33000, 40400, 21400, 17400, 18300, 17100, 17500, 17500, 22300, 22500, 22500, 23750, 31300, 31000, 30500, 32700, 28700, 29900, 27800, 26800, 26800, 26000, 26800, 19000, 27600, 18900, 18700, 21100, 21150, 26000, 26800, 25000, 27900, 11950, 10600, 13900, 14500, 14580, 13500, 22500, 24800, 25000, 32000, 30800, 32000, 26000, 30000, 29200, 32300, 21900, 30000, 26900, 24600, 26900, 28500, 28500, 28800, 28000, 25900, 25300, 27000, 37400, 34500, 32000, 46500, 45800, 16000, 21500, 35000, 39900, 32000, 33500, 32000, 31200, 34000, 41000, 36900, 40250, 37500, 27900, 29000, 28300, 30650, 31500, 31400, 31400, 37500, 45200, 20000, 45950, 45800, 45800, 33850, 25800, 31550, 19900, 18800, 58500, 11000, 17900, 29750, 14500, 15000, 19500, 17700, 18850, 18400, 21800, 19900, 33000, 41300, 43000, 14200, 15000, 13000, 14400, 15200, 14450, 14300, 15000, 14400, 14750, 16500, 26800, 25000, 34500, 35000, 39000, 47200, 41500, 44000, 17200, 16300, 18800, 20200, 24500, 17500, 17200, 22400, 26500, 17500, 17000, 24500, 20000, 19600, 21000, 19500, 23000, 25400, 26700, 26000, 26900, 37800, 35700, 14000, 14900, 16400, 17000, 16500, 17900, 23700, 22000, 49000, 26500, 32700, 33700, 33700, 31000, 42700, 33000, 42500, 40500, 38500, 17400, 18300, 19300, 18800, 22800, 23000, 38800, 29900, 40800, 40300, 50200, 50000, 60000, 45800, 45000, 43600, 46750, 50000, 27200, 34000, 33000, 13100, 39000, 14800, 44500, 43500, 53000, 42000, 36800, 40000, 42000, 43000, 43000, 51500, 20000, 50000, 26500, 26450, 35350, 37700, 38000, 75000, 75300, 34000, 42750, 47000, 42000, 37500, 36000, 48500, 45500, 25000, 27250, 29900, 32900, 30000, 38800, 37300, 39500, 45000, 39600, 39000, 32500, 29000, 33900, 27800, 45600, 44000, 49900, 45000, 47000, 42500, 59950, 53500, 32000, 33800, 50500, 43000, 29000, 35000, 38400, 37998, 28000, 26500, 37000, 39500, 34150, 45000, 12890, 12890, 39500, 40000, 36500, 41000, 53000, 49000, 35500, 34300, 29000, 17220, 34000, 35000, 35500, 33700, 41000, 43800, 41000, 43000, 50500, 51800, 51000, 49500, 51500, 50500, 60000, 45000, 33300, 33700, 33000, 32900, 35000, 36500, 42500, 47000, 31000, 31000, 36700, 33500, 33900, 47700, 37900, 21000, 27500, 27000, 28000, 33400, 36000, 35000, 34000, 36500, 41000, 27500, 35400, 41000, 46500, 49000, 49000, 32500, 31000, 31700, 33000, 41000, 40700, 44800, 47000, 40500, 49500, 36900, 38000, 40500, 45000, 33000, 26800, 32000, 38000, 50700, 37000, 37000, 35500, 38000, 31900, 35600, 36850, 35000, 43400, 42800, 44500, 43000, 37000, 42000, 39900, 39300, 48400, 48400, 48800, 58800, 57000, 28950, 29800, 38000, 53000, 22000, 22400, 23500, 35000, 28000, 29900, 28400, 36200, 37000, 39800, 41000, 49900, 60600, 49000, 15492, 15492, 15492, 15492, 15530, 15807, 15492, 15492, 15650, 16438, 16438, 15492, 15492, 15492, 16030, 15492, 15650, 16438, 15650, 15176, 15492, 16438, 15807, 16156, 15998, 16472, 15840, 15998, 15524, 15840, 15840, 15840, 15524, 15840, 15840, 15524, 15682, 15840, 15840, 15682, 15840, 15524, 15840, 16156, 15840, 16156, 15524, 15998, 15998, 15524, 15524, 15524, 15524, 21584, 21584, 22014, 21799, 21794, 21799, 21584, 21579, 34700, 40500, 37500, 42500, 48000, 50000, 59000, 46000, 59000, 51800, 68300, 35800, 35750, 43400, 46000, 60000, 53800, 40000, 40000, 44400, 46200, 59970, 65000, 73500, 78500, 81500, 80000, 76500, 75700, 54500, 59500, 76000, 45000, 39700, 43000, 33100, 49500, 53000, 51000, 52700, 39000, 39500, 31150, 35500, 37000, 36000, 36050, 37000, 37000, 37000, 36000, 30300, 37400, 50000, 88000, 48500, 56000, 44000, 61000, 61000, 34700, 51000, 40650, 40000, 58000, 80000, 79900, 89000, 104500, 44500, 45000, 58900, 42700, 44000, 49000, 44700, 46500, 40000, 40000, 40000, 41900, 40800, 40000, 57200, 56000, 36350, 41500, 54000, 54900, 53000, 53000, 64000, 38500, 51000, 51000, 30000, 30000, 39800, 56500, 68000, 30900, 31500, 53500, 55400, 57500, 60000, 58500, 54500, 54700, 50800, 55250, 63300, 34500, 41000, 40900, 53500, 40000, 64000, 63300, 85257, 27500, 37950, 38000, 36500, 49000, 34700, 32500, 28200, 28600, 31000, 23500, 41500, 57000, 67500, 68000, 86547, 86033, 87517, 86033, 51000, 49500, 48000, 62900, 60000, 72800, 72900, 86000, 41500, 62700, 66500, 52000, 50500, 68900, 66000, 66000, 66000, 67250, 63000, 69000, 66000, 66000, 82000, 36800, 57500, 44500, 46800, 46500, 67000, 68800, 33300, 29000, 29000, 34800, 45000, 53300, 60400, 47000, 46700, 48000, 48300, 49500, 49500, 48800, 59900, 60000, 72000, 28050, 32600, 59250, 39750, 42950, 41800, 50000, 56350, 32500, 83000, 44000, 55500, 63000, 60000, 60000, 64500, 41000, 43000, 44800, 58000, 18100, 37500, 37400, 47000, 51000, 58000, 54500, 53300, 59900, 59500, 53500, 29000, 28900, 28900, 37600, 39000, 42000, 47700, 44500, 49000, 50000, 48000, 50000, 49500, 49700, 50000, 32000, 38250, 39400, 39300, 40000, 49600, 52200, 55530, 45000, 41500, 39500, 41900, 30700, 30800, 52700, 49000, 72000, 92000, 69500, 65000, 70000, 83000, 86500, 83500, 43000, 68000, 67000, 58400, 45000, 59500, 63700, 63000, 64000, 64300, 68800, 70500, 81500, 38000, 50000, 49800, 50000, 59000, 76500, 60000, 60000, 72700, 130500, 69000, 26900, 25000, 56800, 54500, 60000, 41000, 41000, 44950, 42700, 19150, 18650, 42000, 44000, 52800, 54000, 75000, 31500, 34000, 40000, 43000, 43000, 47300, 57000, 30500, 29500, 43700, 51800, 48000, 48000, 48400, 45000, 51000, 49700, 49400, 40800, 40400, 35000, 40100, 40400, 51900, 45800, 29800, 29600, 44800, 48000, 47000, 46500, 59000, 80000, 69500, 42000, 49700, 70400, 43000, 32500, 127308, 29800, 37000, 38400, 39400, 44900, 45000, 43800, 44900, 46500, 45800, 40500, 35000, 60000, 47000, 46000, 47000, 55000, 53000, 48000, 69000, 68500, 98000, 47000, 46000, 47700, 52800, 40200, 47800, 54950, 53000, 24000, 23000, 49900, 90000, 84900, 32000, 52000, 63600, 64000, 88000, 49700, 66300, 37000, 53000, 53000, 50000, 45700, 53000, 45800, 50000, 58000, 58000, 52000, 59000, 62500, 63600, 64000, 64300, 47000, 47800, 57000, 96000, 116000, 102000, 98500, 128000, 115000, 130000, 44300, 40000, 68500, 42800, 30500, 42000, 44800, 40000, 34000, 33500, 42000, 45500, 39000, 48000, 52250, 38500, 30000, 46600, 47800, 46800, 74800, 35400, 47500, 36500, 37000, 28000, 45000, 45000, 46000, 40000, 50700, 40000, 47000, 46700, 55000, 55500, 57500, 57500, 56000, 54500, 60000, 58500, 73000, 37000, 36200, 36800, 40700, 45000, 31900, 32000, 32000, 29800, 33400, 32000, 32000, 37200, 40000, 40000, 36000, 45000, 40700, 34800, 40300, 40000, 37500, 89000, 33700, 33700, 49500, 44500, 13200, 14500, 42250, 45500, 45500, 43500, 34000, 36000, 39000, 35000, 46400, 45700, 46000, 37800, 35900, 42000, 42000, 49650, 53800, 48000, 50900, 28500, 29300, 27800, 28300, 44038, 45700, 28700, 32800, 35500, 26800, 26300, 38100, 39000, 37000, 32900, 36400, 34300, 45000, 48000, 19000, 20400, 21500, 22800, 24500, 24700, 25500, 32500, 34500, 44500, 45000, 45800, 43300, 19440, 19800, 28500, 41500, 39400, 44500, 23850, 28900, 38000, 38000, 23000, 57900, 48950, 40000, 46800, 45500, 53000, 44500, 43000, 41500, 41500, 33000, 19900, 24600, 27500, 33000, 45500, 30250, 31000, 30500, 31000, 28400, 28000, 40500, 40700, 41500, 93000, 90000, 115000, 120000, 182000, 98500, 76000, 143000, 138000, 230000, 238000, 243000, 293000, 303000, 90000, 215000, 217000, 129750, 129900, 89700, 90000, 88000, 90000, 103000, 154500, 145900, 125000, 132000, 187500, 225000, 53000, 197000, 73250, 130000, 131000, 147000, 72000, 136700, 140000, 106000, 160000, 72500, 72500, 78000, 67500, 87000, 83900, 159000, 170000, 115000, 128000, 63000, 64500, 61600, 67100, 87500, 90000, 212000, 85000, 27000, 27000, 79500, 65000, 117000, 94500, 140000, 46300, 69250, 83000, 87500, 80000, 87700, 59000, 57000, 81800, 90000, 54000, 110000, 109800, 137000, 137500, 175000, 55500, 150000, 87000, 76000, 85000, 108000, 39500, 55000, 143000, 30000, 97000, 115000, 119500, 81000, 25211, 35200, 34900, 58000, 80700, 93900, 93250, 125000, 73050, 93000, 93800, 91000, 107000, 107500, 68800, 85000, 25200, 25000, 102500, 147000, 156000, 110000, 87700, 120000, 127000, 108500, 82500, 79750, 84500, 108000, 90000, 89000, 87500, 86000, 111000, 88500, 24300, 24300, 25000, 26500, 26000, 25300, 25600, 25000, 97000, 63800, 60000, 81500, 74800, 88500,
        74500, 75000, 74000, 82000, 110000, 110000, 69000, 51000, 100000, 100000, 99000, 101700, 120000, 140000, 167000, 67400, 33000, 82700, 81000, 96900, 96800, 98500, 69000, 65700, 68500, 68500, 70000, 67000, 209000, 49500, 70000, 70000, 73000, 76000, 23000, 96000, 96000, 85500, 79400, 84800, 96000, 89000, 86000, 52000, 55000, 74900, 75000, 75000, 73800, 31500, 78750, 97500, 97000, 118500, 124500, 120000, 59800, 68000, 90000, 88500, 90000, 108000, 61900, 60000, 59800, 90000, 119000, 116000, 131500, 120000, 151000, 115000, 183000, 105000, 109500, 70000, 68800, 69000, 68800, 68500, 70000, 147000, 89800, 90000, 61800, 115000, 198000, 54900, 54500, 96300, 90000, 82600, 84500, 67000, 45700, 45000, 50000, 49900, 54500, 39400, 38000, 33600, 33600, 38600, 46800, 47000, 52500, 53000, 57000, 46000, 66000, 66500, 59000, 53400, 73500, 68000, 72500, 86000, 47500, 47800, 60000, 55000, 56500, 60000, 60000, 59000, 38400, 45000, 49800, 48000, 57000, 55200, 54000, 60000, 54300, 69500, 72500, 86000, 86000, 55500, 84000, 77500, 72000, 100000, 100000, 45400, 45200, 55500, 39800, 55500, 43000, 27900, 34400, 33700, 34200, 42000, 40000, 43000, 49800, 29500, 65000, 64800, 70000, 60000, 52200, 43000, 46500, 46000, 48500, 60000, 51000, 45000, 44500, 64000, 36900, 35500, 45500, 44800, 43000, 52550, 50000, 43900, 44400, 42500, 46000, 51900, 32800, 59000, 41000, 42700, 56000, 45000, 42000, 74300, 34500, 39750, 54000, 55000, 53000, 54000, 57500, 51500, 57500, 63500, 59800, 57000, 26100, 37250, 84000, 65500, 62500, 83000, 46500, 65000, 88000, 62500, 62000, 62500, 67000, 100000, 140000, 38000, 35000, 40200, 38800, 50000, 44000, 37000, 42500, 45000, 43000, 44000, 42000, 48000, 41500, 44567, 42500, 59900, 50000, 57300, 59850, 71000, 68000, 43500, 34800, 38800, 53000, 38800, 42000, 37500, 12400, 48000, 39000, 45000, 43500, 45500, 39000, 53500, 52900, 52800, 54900, 64500, 68400, 64300, 51000, 71500, 52500, 52500, 52900, 63500, 60000, 65000, 65500, 62000, 62700, 33000, 33000, 38500, 47000, 46900, 60000, 48000, 42900, 45300, 45900, 43000, 58000, 64700, 59900, 69500, 44000, 46000, 46500, 46500, 44000, 47000, 45000, 53700, 54500, 55000, 54700, 55500, 66000, 47500, 46500, 46900, 59700, 55000, 52100, 53000, 58000, 53500, 66950, 67800, 69000, 43500, 53500, 70800, 35900, 43000, 38000, 40400, 41000, 40000, 41000, 29800, 34200, 39400, 38000, 48500, 48900, 49800, 48500, 45800, 54800, 56000, 55000, 63000, 59500, 41500, 41500, 44900, 59900, 61000, 69000, 38900, 37200, 41200, 49900, 38000, 37500, 39900, 45000, 45500, 48000, 46000, 46000, 43900, 44000, 46900, 47000, 28000, 26500, 26800, 38400, 60000, 60000, 30700, 39000, 39000, 40500, 42000, 41900, 42300, 42500, 49500, 49250, 50500, 38000, 45500, 56300, 26950, 32000, 42250, 39500, 39500, 39600, 39500, 42800, 32500, 33000, 41000, 42000, 42200, 50700, 50000, 47500, 28800, 38350, 46500, 29100, 33700, 34000, 28000, 48700, 63300, 50000, 52800, 36300, 49750, 44300, 45300, 54000, 53000, 54500, 35500, 42600,
        74500, 31000, 31700, 31300, 39000, 40700, 44250, 43500, 27700, 29000, 29000, 34000, 34700, 41750, 41800, 56500, 22700, 45000, 46500, 23800, 23950, 33000, 28250, 39500, 45500, 47300, 44100, 44700, 47000, 27000, 29000, 19000, 33900, 37000, 38900, 29000, 29900, 29500, 45500, 16750, 16300, 18300, 17700, 37300, 23000, 40000, 50000, 26200, 33000, 27300, 27300, 24500, 30000, 22500, 47000, 47500, 45500, 46000, 57000, 53000, 32900, 41400, 45000, 40500, 45200, 36300, 33000, 41000, 55000, 39000, 38000, 31700, 40000, 39000, 34900, 40700, 41500, 38500, 38200, 38000, 33300, 43500, 45000, 35550, 35750, 21900, 22000, 27400, 27400, 41500, 27900, 27400, 31000, 29800, 36000, 36000, 39900, 35800, 38000, 37000, 38000, 43000, 43000, 44000, 41900, 18000, 56800, 60000, 41400, 42000, 43000, 54000, 53000, 47800, 46400, 59000, 63700, 36200, 36800, 37000, 34500, 37300, 41000, 42700, 42500, 50000, 50800, 37500, 38200, 50300, 47400, 50300, 51500, 37200, 38300, 38300, 37400, 44500, 42500, 32900, 36750, 35500, 44800, 44700, 52500, 28300, 36700, 39000, 40900, 48700, 48000, 58900, 41900, 44750, 42500, 36000, 37500, 38000, 30000, 42000, 42500, 43500, 44500, 37200, 29000, 47900, 48000, 48000, 49000, 45500, 44500, 48800, 49000, 48400, 65000, 61500, 52100, 53800, 50500, 43800, 40800, 40000, 52000, 81000, 14950, 18500, 60000, 79350, 77000, 73000, 57400, 65000, 54000, 58300, 58300, 58000, 79000, 57200, 57500, 56069, 66900, 76500, 71411, 67300, 67300, 52500, 48700, 57167, 57167, 78200, 95508, 46900, 45500, 43500, 53300, 51600, 52000, 29000, 49500, 50000, 23500, 24000, 25500, 32800, 55800, 25370, 38800, 31500, 37000, 51000, 34000, 50000, 54700, 46000, 43000, 46400, 43000, 37000, 54900, 35300, 28500, 30000, 56500, 56700, 38400, 40000, 52000, 84700, 78000, 18000, 18350, 20500, 29000, 30000, 30500, 54500, 39900, 64800, 75000, 72500, 79000, 78900, 90000, 90000, 90000, 87000, 93950, 95500, 100000, 108500, 108500, 113000, 64500, 30000, 27800, 127000, 83000, 79000, 89500, 119000, 117000, 118900, 134000, 83000, 44500, 48500, 51000, 60000, 55000, 53250, 55500, 53000, 104600, 45000, 45000, 44700, 51000, 57500, 64000, 63000, 79000, 80500, 45500, 86500, 50000, 51400, 48400, 43000, 60000, 59800, 58000, 57950, 71500, 85900, 78500, 84000, 79500, 70500, 71800, 85200, 70000, 80000, 44000, 44000,
        74500, 75750, 75000, 74500, 73200, 70000, 73000, 75000, 75000, 90000, 92300, 86200, 89500, 87500, 89000, 89000, 89800, 87500, 79000, 89000, 86800, 84500, 86000, 90000, 84500, 84300, 90000, 90000, 99000, 94500, 127000, 150000, 47000, 46300, 46500, 59800, 60000, 60000, 75500, 32000, 33000, 33900, 30500, 41800, 55000, 56000, 22500, 22700, 28500, 61000, 60000, 87000, 80000, 95500, 19700, 20000, 60000, 74200, 73000, 78000, 77000, 76000, 76500, 78300, 97500, 99000, 90000, 95500, 100500, 118500, 135500, 42000, 51000, 45000, 48000, 53000, 50800, 44900, 51800, 96700, 107500, 96000, 110000, 100000, 109000, 128000, 126000, 77750, 89000, 81000, 79800, 83000, 81800, 84500, 81000, 95500, 99000, 95000, 99000, 97000, 106800, 96000, 95000, 57500, 111300, 115000, 115000, 116000, 115500, 128800, 130000, 127600, 126200, 126000, 130000, 129000, 129000, 128800, 80800, 80000, 82900, 78000, 94500, 94200, 93500, 91500, 124000, 124000, 60000, 67000, 56500, 60000, 65000, 65750, 70000, 56500, 58000, 59950, 57500, 60000, 59500, 63000, 60000, 64300, 60000, 41000, 39800, 45950, 49900, 51700, 40500, 51000, 51300, 37800, 52500, 37800, 48500, 36500, 37500, 53000, 24900, 49700, 53000, 58000, 57500, 59000, 34000, 35000, 35000, 45100, 45000, 44800, 45000, 45000, 44000, 64500, 50500, 43500, 65000, 72700, 39500, 67700, 66800, 28000, 47500, 51500, 51200, 58000, 53000, 59500, 60000, 77500, 73000, 87000, 90000, 90000, 89300, 90000, 89900, 89000, 64500, 66000, 69400, 90000, 116000, 51000, 50500, 51800, 65500, 90000, 89800, 128700, 71500, 89900, 47900, 55500, 73000, 72500, 104000, 34000, 52300, 71600, 70000, 81500, 86000, 68000, 40900, 56800, 33400, 28800, 32000, 30700, 26700, 38000, 52400, 37000, 30000, 24000, 59000, 39700, 39700, 47900, 31700, 40000, 59400, 59800, 69000, 45000, 46000, 56000, 65800, 68250, 64750, 122000, 115700, 127500, 120000, 161000, 120000, 120000, 128000, 24000, 62000, 44000, 149500, 21000, 18400, 18950, 24000, 24800, 24000, 22900, 30900, 30500, 30100, 23000, 38850, 36700, 39500, 49600, 48800, 69800, 44000, 24000, 29800, 24900, 25900, 30800, 35000, 36000, 22800, 25000, 24000, 27500, 28200, 30000, 34500, 24800, 19700, 30800, 33600, 35000, 23000, 13900, 12850, 16500, 18300, 24000, 25200, 24750, 31700, 30500, 30000, 30000, 27500, 26000, 18400, 17400, 17000, 23500, 28000, 26800, 26800, 27500, 40000, 43800, 29900, 30000, 25100, 29000, 23000, 30250, 28500, 22000, 22500, 20000, 30500, 30100, 31800, 24500, 31900, 24250, 16300, 53500, 44800, 55000, 56000, 46200, 49400, 28350, 35000, 29200, 40500, 51800, 53000, 54200, 47000, 47500, 60000, 36800, 60000, 59900, 62900, 22500, 38000, 55200, 57500, 47700, 52800, 53000, 68500, 46800, 43700, 65500, 79800, 43000, 40800, 42200, 41000, 39300, 40750, 40800, 51000, 54500, 45200, 45500, 48300, 52500, 47000, 60000, 60000, 60000, 85500, 120000, 46000, 60000, 63800, 57000, 73300, 72800, 75750, 94000, 48200, 49700, 66900, 62000, 63200, 64000, 89000, 107000, 107500, 40300, 39800, 50000, 44800, 42800, 44700, 47000, 45800, 57300, 54500, 59500, 68000, 33000, 18500, 38000, 34500, 17800, 27500, 35000, 36500, 37000, 48000, 25500, 25500, 25800, 26000, 24000, 26350, 26900, 25000, 23400, 25500, 26900, 23900, 26000, 31500, 47000, 46000, 24300, 24300, 25850, 24000, 24900, 22780, 30000, 27850, 28500, 31900, 41650, 45000, 42000, 46400, 43500, 63700, 68000, 37000, 39900, 39700, 40000, 40000, 38000, 43600, 43600, 43500, 42000, 41850, 53000, 56000, 33000, 34200, 40000, 41000, 41900, 35400, 35500, 40000, 32000, 19400, 23000, 20500, 29000, 23000, 26500, 30000, 27500, 27000, 39800, 35000, 43000, 22950, 39000, 39500, 40500, 39300, 44400, 52000, 55000, 52500, 54000, 55000, 53400, 46500, 36000, 41000, 42800, 37000, 38900, 69000, 26800, 17200, 26000, 50000, 18000, 36000, 54500, 53000, 61000, 65000, 42800, 42750, 40700, 56900, 43000, 48500, 80000, 80000, 88500, 88000, 41200, 37700, 43750, 36500, 36300, 41500, 45000, 44500, 41500, 43000, 42000, 42000, 42000, 42000, 55000, 55000, 56500, 62000, 71500, 87000, 91000, 91900, 34000, 34300, 45500, 47000, 54500, 13300, 36000, 39900, 25500, 26800, 27000, 26400, 26800, 26350, 26000, 27000, 25850, 33000, 30000, 26500, 26200, 30400, 36200, 34500, 32500, 30800, 36000, 33600, 35000, 33200, 24900, 17700, 19200, 37700, 33700, 59800, 26200, 33900, 35500, 38000, 42350, 31500, 40000, 60000, 71000, 70800, 70800, 73000, 75000, 85000, 45550, 46700, 39800, 30000, 38000, 31500, 30800, 42000, 31500, 51500, 29000, 30800, 31500, 23700, 26900, 26900, 26400, 26800, 39800, 43300, 41000, 40000, 43200, 43000, 48000, 24200, 25000, 25700, 24500, 25000, 23100, 36000, 24100, 29400, 42900, 33500, 49000, 49500, 19500, 19900, 20000, 24000, 33000, 34400, 32000, 43000, 41100, 44000, 35800, 44500, 38000, 43000, 39000, 36000, 38200, 11500, 33300, 28500, 29500, 35100, 36000, 44900, 27300, 28300, 32600, 40750, 40200, 40250, 37500, 35600, 27300, 47500, 44500, 50000, 29900, 29400, 29500, 30000, 35600, 29300, 26100, 28500, 28300, 29000, 32900, 39500, 42000, 43000, 40900, 51500, 38000, 42500, 44500, 45500, 38000, 33000, 44000, 46500, 41300, 40000, 38000, 39000, 43700, 39500, 39500, 37700, 43500, 44500, 44800, 41800, 40000, 22000, 37800, 40500, 33400, 33000, 35000, 35500, 44500, 46000, 37500, 40000, 35750, 35400, 34800, 34500, 48500, 49400, 47300, 47000, 31800, 30000, 29000, 33000, 86500, 114000, 72500, 68000, 90000, 105500, 82000, 84000, 81000, 47000, 87500, 73700, 73700, 135000, 133000, 81000, 120700, 66000, 73000, 44000, 34500, 39900, 40000, 38500, 40100, 45500, 46300, 46300, 48000, 43400, 48000, 47100, 44900, 49950, 45900, 51000, 47000, 51000, 9700, 11950, 11300, 5000, 32900, 34500, 44700, 48000, 57500, 58500, 60000, 72000, 70800, 61750, 49000, 51200, 45900, 56000, 54700, 77500, 49200, 43200, 57500, 74000, 40000, 62500, 77900, 49600, 145000, 54000, 53000, 47000, 47750, 56700, 36600, 38000, 170000, 149000, 36000, 38000, 38000, 55500, 77000, 87800, 89950, 79700, 125000, 69700, 79700, 60000, 50000, 83000, 88000, 90000, 52000, 52700, 52300, 83000, 155000, 58500, 80000, 80700, 106000, 85500, 141500, 158000, 55500, 85000, 95000, 54300, 68500, 99900, 75000, 21800, 169500, 169500, 105000, 149500, 56500, 117000, 130000, 42000, 44750, 690000, 61250, 285000, 33000, 30000, 36400, 65000, 48300, 42500, 46000, 23000, 20700, 33000, 35000, 37500, 36000, 25200, 28000, 33900, 33500, 22200, 25100, 24350, 20000, 40350, 27450, 25000, 26750, 24000, 21100, 26800, 24000, 36800, 32000, 31300, 34700, 30000, 36000, 31500, 21800, 24000, 11200, 26500, 36500, 41500, 26500, 25900, 38500, 30000, 32400, 38500, 39500, 49000, 45500, 53000, 52500, 59500, 47500, 44800, 39300, 39500, 41900, 38750, 49100, 47500, 47100, 47250, 62500, 64000, 39500, 47900, 49500, 48400, 50000, 50000, 49700, 30500, 29500, 31500, 30300, 30000, 30200, 30600, 38400, 35000, 46000, 46000, 43000, 23000, 22000, 30900, 31300, 38800, 38500, 29000, 24000, 30000, 24800, 26500, 26000, 39000, 31000, 19700, 25000, 24000, 38000, 39000, 26000, 28000, 29650, 19700, 38500, 26700, 31000, 17000, 32000, 46500, 47500, 18000, 27100, 26900, 46800, 46000, 39700, 35000, 38900, 27800, 26000, 37500, 36750, 45400, 47500, 38000, 39000, 47800, 19800, 21000, 23500, 27800, 22400, 22900, 28500, 28000, 26500, 47300, 54000, 53500, 42200, 53000, 53800, 64000, 41000, 54950, 73000, 53000, 53250, 58500, 39000, 66500, 54800, 50300, 54500, 62800, 46000, 61000, 52500, 46000, 45500, 53000, 50000, 37300, 60000, 47800, 45400, 48000, 53100, 51900, 57000, 54000, 59500, 55000, 66500, 69206, 113500, 44000, 48500, 53000, 71000, 60000, 36750, 37490, 54990, 60450, 58490, 34000, 80000, 105000, 41300, 42700, 49500, 42000, 26700, 17000, 64000, 20000, 50000, 52500, 30000, 30500, 33800, 36000, 32950, 36700, 30000, 30000, 40000, 39800, 36500, 65000, 34000, 59550, 41800, 45000, 46000, 43500, 43500, 44000, 60000, 67500, 70800, 58500, 58800, 70600, 69000, 39000, 39000, 40700, 42500, 57500, 50700, 54500, 37000, 43300, 41800, 41100, 36000, 50250, 58000, 60000, 55500, 71000, 62500, 72850, 86500, 80000, 44000, 37000, 38900, 62000, 45000, 48500, 61500, 59700, 56000, 71800, 70800, 65000, 15300, 42500, 43500, 40500, 41300, 41000, 50300, 51900, 49000, 53000, 87163, 85121, 99046, 96062, 101035, 104490, 103024, 76196, 99622, 98000, 127000, 143000, 40000, 29000, 34700, 32000, 37000, 31200, 10500, 10500, 17800, 18000, 22700, 23000, 30000, 18200, 43000, 42300, 44500, 38000, 45500, 26500, 47000, 31000, 29300, 38200, 40900, 34200, 42800, 42500, 29000, 31000, 39500, 42000, 40700, 36800, 25300, 26500, 35700, 16800, 18000, 22700, 23500, 27000, 28000, 25200, 14300, 14300, 18500, 20000, 33000, 30000, 32700, 41500, 34500, 38000, 27200, 26000, 48000, 44200, 29700, 59000, 58800, 59650, 55000, 59600, 70000, 43000, 44500, 22800, 23000, 19500, 18500, 18000, 18500, 24400, 26000, 26500, 28900, 27300, 29950, 49900, 49900, 27000, 27000, 37500, 36800, 26100, 25450, 27500, 36000, 16250, 20450, 38700, 37000, 43500, 35000, 35000, 46000, 45500, 44000, 47000, 27000, 25000, 31000, 28000, 31150, 35000, 34800, 44800, 53000, 61800, 69000, 47700, 27000, 27400, 26000, 19400, 46000, 44000, 47000, 51800, 25000, 28000, 38200, 38000, 24000, 23500, 29000, 36500, 35700, 24300, 26500, 31000, 31000, 31850, 33800, 34000, 30000, 32500, 32000, 33000, 28500, 19300, 20300, 27500, 19200, 19300, 19900, 18000, 19900, 22500, 21602, 29000, 15500, 16000, 16850, 18600, 18500, 24500, 23150, 43000, 42300, 35800, 43800, 52700, 38000, 37000, 35900, 34000, 11000, 38000, 26200, 26200, 24900, 29700, 29500, 30000, 30500, 30000, 29700, 30800, 31000, 28000, 30000, 30000, 36750, 35500, 22500, 27000
    };
    final BitSlicer<Long> slicer = new BitSlicer.LongType(factory);
    for (long v : input) {
      slicer.add(v);
    }
    final BitSlicedBitmap<Long> bitmap = slicer.build();
    for (BitmapFactory factory : new BitmapFactory[]{
        new RoaringBitmapFactory(),
        new BitSetBitmapFactory(),
        new ConciseBitmapFactory()
    }) {
      final Random x = new Random();
      final int iteration = factory instanceof RoaringBitmapFactory ? 200 : 20;  // takes too much time for others
      for (LONG_OP op : LONG_OP.values()) {
        for (int i = 0; i < iteration; i++) {
          final long value = input[x.nextInt(input.length)];
          final Range<Long> range = Ranges.<Long>of(value, op.op());
          final ImmutableBitmap result = bitmap.filterFor(range, null).bitmap();
          final IntIterator iterator = result.iterator();
          for (int j = 0; j < input.length; j++) {
            if (op.apply(input[j], value)) {
              Assert.assertTrue(iterator.hasNext());
              Assert.assertEquals(j, iterator.next());
            }
          }
          Assert.assertTrue(!iterator.hasNext() || iterator.next() >= input.length); // concise makes some tails..
        }
      }
    }
    bitmap.close();
  }

  enum LONG_OP
  {
    GT {
      String op() { return ">"; }
      boolean apply(long x, long y) { return x > y; }
    },
    LT {
      String op() { return "<"; }
      boolean apply(long x, long y) { return x < y; }
    },
    GTE {
      String op() { return ">="; }
      boolean apply(long x, long y) { return x >= y; }
    },
    LTE {
      String op() { return "<="; }
      boolean apply(long x, long y) { return x <= y; }
    },
    EQ {
      String op() { return "=="; }
      boolean apply(long x, long y) { return x == y; }
    };
    abstract String op();
    abstract boolean apply(long x, long y);
  }

  @Test
  @Ignore("deprecated")
  public void testFloatRanges()
  {
    final Random x = new Random();
    final float[] input = new float[10000];
    for (int i = 0; i < input.length; i++) {
      input[i] = Float.intBitsToFloat(x.nextInt());
    }
    for (BitmapFactory factory : new BitmapFactory[]{
        new RoaringBitmapFactory(),
        new BitSetBitmapFactory(),
        new ConciseBitmapFactory()
    }) {
      final int iteration = factory instanceof ConciseBitmapFactory ? 200 : 20;  // takes too much time for others
      final BitSlicer<Float> slicer = new BitSlicer.FloatType(factory);
      for (float v : input) {
        slicer.add(v);
      }
      final BitSlicedBitmap<Float> bitmap = slicer.build();
      for (FLOAT_OP op : FLOAT_OP.values()) {
        for (int i = 0; i < iteration; i++) {
          final float value = input[x.nextInt(input.length)];
          final Range<Float> range = Ranges.<Float>of(value, op.op());
          final ImmutableBitmap result = bitmap.filterFor(range, null).bitmap();
          final IntIterator iterator = result.iterator();
          for (int j = 0; j < input.length; j++) {
            if (op.apply(input[j], value)) {
              Assert.assertTrue(iterator.hasNext());
              Assert.assertEquals(j, iterator.next());
            }
          }
          Assert.assertTrue(!iterator.hasNext() || iterator.next() >= input.length); // concise makes some tails..
        }
      }
      bitmap.close();
    }
  }

  @Test
  public void testFloatRanges2() throws IOException
  {
    final Random x = new Random();
    final float[] input = new float[1000000];
    for (int i = 0; i < input.length; i++) {
      input[i] = Float.intBitsToFloat(x.nextInt());
    }
    BitmapFactory factory  = new RoaringBitmapFactory();
    RoaringBitmapSerdeFactory serdeFactory = new RoaringBitmapSerdeFactory();
    final BitSlicer<Float> slicer = new BitSlicer.FloatType(factory);
    for (float v : input) {
      slicer.add(v);
    }
    BitSlicedBitmap<Float> bitmap = slicer.build();
    BitSlicedBitmaps.SerDe serde = new BitSlicedBitmaps.SerDe(ValueType.FLOAT, serdeFactory, bitmap);
    final ByteArrayOutputStream bout = new ByteArrayOutputStream();
    final WritableByteChannel channel = new WritableByteChannel()
    {
      @Override
      public int write(ByteBuffer src) throws IOException
      {
        byte[] array = new byte[src.remaining()];
        src.get(array);
        bout.write(array);
        return array.length;
      }

      @Override
      public boolean isOpen()
      {
        return true;
      }

      @Override
      public void close()
      {
      }
    };
    ColumnBuilder builder = new ColumnBuilder("test");
    builder.setType(ValueDesc.FLOAT);
    ColumnPartSerde.Serializer serializer = serde.getSerializer();
    serializer.getSerializedSize();
    serializer.writeToChannel(channel);
    serde.getDeserializer().read(ByteBuffer.wrap(bout.toByteArray()), builder, serdeFactory);
    Column column = builder.build();

    BitSlicedBitmap<Float> bsb = column.getBitSlicedBitmap();
    for (BitSlicedBitmap<Float> target : Arrays.asList(bitmap, bsb)) {
      long start = System.currentTimeMillis();
      for (int i = 0; i < 20; i++) {
        FLOAT_OP op = FLOAT_OP.GT;
        final float value = input[x.nextInt(input.length)];
        final Range<Float> range = Ranges.<Float>of(value, op.op());
        final ImmutableBitmap result = target.filterFor(range, null).bitmap();
        final IntIterator iterator = result.iterator();
        for (int j = 0; j < input.length; j++) {
          if (op.apply(input[j], value)) {
            Assert.assertTrue(iterator.hasNext());
            Assert.assertEquals(j, iterator.next());
          }
        }
        Assert.assertTrue(!iterator.hasNext() || iterator.next() >= input.length); // concise makes some tails..
      }
      System.out.println("> Took " + (System.currentTimeMillis() - start) + " msec");
      target.close();
    }
  }

  enum FLOAT_OP
  {
    GT {
      String op() { return ">"; }
      boolean apply(float x, float y) { return x > y; }
    },
    LT {
      String op() { return "<"; }
      boolean apply(float x, float y) { return x < y; }
    },
    GTE {
      String op() { return ">="; }
      boolean apply(float x, float y) { return x >= y; }
    },
    LTE {
      String op() { return "<="; }
      boolean apply(float x, float y) { return x <= y; }
    },
    EQ {
      String op() { return "=="; }
      boolean apply(float x, float y) { return x == y; }
    };
    abstract String op();
    abstract boolean apply(float x, float y);
  }

  @Test
  @Ignore("deprecated")
  public void testDoubleRanges()
  {
    final Random x = new Random();
    final double[] input = new double[10000];
    for (int i = 0; i < input.length; i++) {
      input[i] = Double.longBitsToDouble(x.nextLong());
    }
    final BitSlicer<Double> slicer = new BitSlicer.DoubleType(factory);
    for (double v : input) {
      slicer.add(v);
    }
    final BitSlicedBitmap<Double> bitmap = slicer.build();
    for (BitmapFactory factory : new BitmapFactory[]{
        new RoaringBitmapFactory(),
        new BitSetBitmapFactory(),
        new ConciseBitmapFactory()
    }) {
      final int iteration = factory instanceof RoaringBitmapFactory ? 200 : 20;  // takes too much time for others
      for (DOUBLE_OP op : DOUBLE_OP.values()) {
        for (int i = 0; i < iteration; i++) {
          final double value = input[x.nextInt(input.length)];
          final Range<Double> range = Ranges.<Double>of(value, op.op());
          final ImmutableBitmap result = bitmap.filterFor(range, null).bitmap();
          final IntIterator iterator = result.iterator();
          for (int j = 0; j < input.length; j++) {
            if (op.apply(input[j], value)) {
              Assert.assertTrue(iterator.hasNext());
              Assert.assertEquals(j, iterator.next());
            }
          }
          Assert.assertTrue(!iterator.hasNext() || iterator.next() >= input.length); // concise makes some tails..
        }
      }
    }
    bitmap.close();
  }

  enum DOUBLE_OP
  {
    GT {
      String op() { return ">"; }
      boolean apply(double x, double y) { return x > y; }
    },
    LT {
      String op() { return "<"; }
      boolean apply(double x, double y) { return x < y; }
    },
    GTE {
      String op() { return ">="; }
      boolean apply(double x, double y) { return x >= y; }
    },
    LTE {
      String op() { return "<="; }
      boolean apply(double x, double y) { return x <= y; }
    },
    EQ {
      String op() { return "=="; }
      boolean apply(double x, double y) { return x == y; }
    };
    abstract String op();
    abstract boolean apply(double x, double y);
  }
}